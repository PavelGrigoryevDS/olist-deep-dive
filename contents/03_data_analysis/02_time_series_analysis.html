
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Time Series Analysis &#8212; 🌊 Deep Sales Analysis of Olist Marketplace</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=aa5847ba" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/custom.js?v=f9582d1e"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contents/03_data_analysis/02_time_series_analysis';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Customer Analysis" href="03_customer_analysis.html" />
    <link rel="prev" title="Creating Analysis Class" href="01_creating_analysis_class.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light.png" class="logo__image only-light" alt="🌊 Deep Sales Analysis of Olist Marketplace - Home"/>
    <script>document.write(`<img src="../../_static/logo-dark.png" class="logo__image only-dark" alt="🌊 Deep Sales Analysis of Olist Marketplace - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    🌊 Deep Sales Analysis of Olist
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Description and Exploration</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_data_description_and_exploration/01_data_description.html">Data Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_data_description_and_exploration/02_data_loading.html">Data Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_data_description_and_exploration/03_data_exploration.html">Data Exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_data_description_and_exploration/04_intermediate_conclusion.html">Intermediate Conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Preprocessing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/01_initial_data_filtering.html">Initial Data Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/02_outlier_handling.html">Outlier Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/03_missing_value_handling.html">Missing Value Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/04_duplicate_handling.html">Duplicate Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/05_creating_new_metrics.html">Creating New Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/06_creating_new_dimensions.html">Creating New Dimensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/07_converting_data_to_a_convenient_format.html">Converting Data to a Convenient Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/08_data_merging.html">Data Merging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_data_preprocessing/09_intermediate_conclusion.html">Intermediate Conclusion</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_creating_analysis_class.html">Creating Analysis Class</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Time Series Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_customer_analysis.html">Customer Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_seller_analysis.html">Seller Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_sales_analysis.html">Sales Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_product_analysis.html">Product Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_review_analysis.html">Review Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_delivery_analysis.html">Delivery Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_payment_analysis.html">Payment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_geographical_analysis.html">Geographical Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_cohort_analysis.html">Cohort Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="12_correlation_analysis.html">Correlation Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="13_slice_analysis.html">Slice Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_analysis_of_customer_segments.html">Analysis of Customer Segments</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_rfm_analysis.html">RFM Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_customer_clustering.html">Customer Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="17_hypothesis_testing.html">Hypothesis Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">General Conclusion</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/01_time_dynamics.html">Time Dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/02_customers.html">Customers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/03_sales.html">Sales</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/04_products.html">Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/05_reviews.html">Reviews</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/06_delivery.html">Delivery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/07_payments.html">Payments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/08_sellers.html">Sellers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/09_cohort_analysis.html">Cohort Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/10_correlation_analysis.html">Correlation Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/11_black_friday.html">Black Friday</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/12_cancelled_orders.html">Cancelled Orders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/13_hypothesis_testing_results.html">Hypothesis Testing Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04_general_conclusion/14_detected_anomalies.html">Detected Anomalies</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Recommendations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/01_product_market_fit.html">Product market fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/02_customer_loyalty_enhancement.html">Customer loyalty Enhancement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/03_customer_experience_improvement.html">Customer Experience Improvement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/04_logistics_and_delivery_optimization.html">Logistics and Delivery Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/05_financial_optimization.html">Financial optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/06_average_order_value_and_basket_optimization.html">Average Order Value and Basket Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/07_segment_specific_strategies.html">Segment-Specific Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/08_product_and_assortment_management.html">Product and Assortment Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/09_marketing_and_promotion.html">Marketing and Promotion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/10_peak_season_preparedness.html">Peak Season Preparedness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/11_analytics_and_monitoring.html">Analytics and Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/12_ab_testing.html">A/B Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05_recommendations/13_anomaly.html">Anomaly</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/PavelGrigoryevDS/olist-deep-dive" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/contents/03_data_analysis/02_time_series_analysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Time Series Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> On this page </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#order-volume-vs-successful-purchases">Order Volume vs. Successful Purchases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#share-of-canceled-orders">Share of Canceled Orders</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-sales">Number of Sales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sales-amount">Sales Amount</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#average-order-value">Average Order Value</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-purchases-per-customer-per-week">Number of Purchases per Customer per Week</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arppu">ARPPU</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-customers">Number of Customers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#share-of-new-customers">Share of New Customers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-sellers">Number of Sellers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#share-of-new-sellers">Share of New Sellers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ratio-of-number-of-sellers-and-customers">Ratio of Number of Sellers and Customers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-orders-per-customer">Number of Orders per Customer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-reviews">Number of Reviews</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#review-score">Review Score</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nps">NPS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#freight-cost-ratio">Freight Cost Ratio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delivery-time">Delivery Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delivery-delay-time">Delivery Delay Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carrier-handoff-delay">Carrier Handoff Delay</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proportion-of-each-stage-in-delivery-time">Proportion of Each Stage in Delivery Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#order-weight">Order Weight</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-products-in-order">Number of Products in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-unique-products-in-order">Number of Unique Products in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#product-price-in-order">Product Price in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-sellers-in-order">Number of Sellers in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-categories-in-order">Number of Categories in Order</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="time-series-analysis">
<h1>Time Series Analysis<a class="headerlink" href="#time-series-analysis" title="Link to this heading">#</a></h1>
<section id="order-volume-vs-successful-purchases">
<h2>Order Volume vs. Successful Purchases<a class="headerlink" href="#order-volume-vs-successful-purchases" title="Link to this heading">#</a></h2>
<p><strong>Order Status Distribution</strong></p>
<p>First, we examine order counts by status. Note that for purchase analysis, we’ll focus solely on delivered orders since other statuses don’t represent completed purchases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">order_id</span> <span class="o">=</span> <span class="s1">&#39;Number of Orders&#39;</span>
    <span class="p">,</span> <span class="n">order_status</span> <span class="o">=</span> <span class="s1">&#39;Order Status&#39;</span>
<span class="p">))</span>
<span class="n">df_orders</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_status&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;nunique&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Orders by Order Status and Month&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bd4bc6a63b6896bf74a4fe89fab982c9ad6500c545a4ae0ca068d28954f68dbc.jpg" src="../../_images/bd4bc6a63b6896bf74a4fe89fab982c9ad6500c545a4ae0ca068d28954f68dbc.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Delivered orders consistently dominated all other statuses throughout the period.</p></li>
</ul>
<p>Let’s look without delivered.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">order_id</span> <span class="o">=</span> <span class="s1">&#39;Number of Orders&#39;</span>
    <span class="p">,</span> <span class="n">order_status</span> <span class="o">=</span> <span class="s1">&#39;Order Status&#39;</span>
<span class="p">))</span>
<span class="n">df_orders</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">order_status</span> <span class="o">!=</span> <span class="s1">&#39;Delivered&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_status&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;nunique&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span>
    <span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Orders by Order Status and Month (Without Delivered)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9a36c5abab69a43ecb9dcbf012b881a79919c73c61abc30ff43fb27ab9adb8b5.jpg" src="../../_images/9a36c5abab69a43ecb9dcbf012b881a79919c73c61abc30ff43fb27ab9adb8b5.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>March-April 2018 saw a sharp spike in orders stuck in “shipped” status</p></li>
<li><p>February and August 2018 peaks in “canceled” status</p></li>
<li><p>November 2017 “unavailable” peak coincided with Black Friday promotions</p></li>
<li><p>As identified during anomaly detection, most of these orders ultimately weren’t delivered for various reasons</p></li>
</ul>
<p>Let’s compare the number of orders and sales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_orders_resampled</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_orders</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Orders&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">tmp_tmp_df_resampled</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sales&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tmp_df_orders_resampled</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">tmp_tmp_df_resampled</span><span class="p">[</span><span class="s1">&#39;sale_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_tmp_df_resampled</span><span class="p">[</span><span class="s1">&#39;Sales&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_tmp_df_resampled</span><span class="p">[</span><span class="s1">&#39;Orders&#39;</span><span class="p">]</span>
<span class="n">tmp_tmp_df_resampled_melted</span> <span class="o">=</span> <span class="n">tmp_tmp_df_resampled</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Orders&#39;</span><span class="p">,</span> <span class="s1">&#39;Sales&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;order_or_sale&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="s1">&#39;Number of Orders&#39;</span>
    <span class="p">,</span> <span class="n">order_or_sale</span> <span class="o">=</span> <span class="s1">&#39;Orders or Sales&#39;</span>
<span class="p">))</span>
<span class="n">tmp_tmp_df_resampled_melted</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_or_sale&#39;</span>
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">category_orders</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">order_or_sale</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Orders&#39;</span><span class="p">,</span> <span class="s1">&#39;Sales&#39;</span><span class="p">])</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Orders and Sales by Month&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1a836ebce50a1c3398d37a11922c994cad9abe18396a4dd427dbcbbdafac13b1.jpg" src="../../_images/1a836ebce50a1c3398d37a11922c994cad9abe18396a4dd427dbcbbdafac13b1.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Stable purchase-to-order ratio maintained month-over-month</p></li>
</ul>
<p>Let’s look at conversion to success sale</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">sale_share</span> <span class="o">=</span> <span class="s1">&#39;Conversion to Sale&#39;</span>
<span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tmp_tmp_df_resampled</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Conversion to Success Sale by Month&#39;</span>
<span class="p">)</span>
<span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7ba9901f6f0d479d1d79aa348e356c5f2fe1f03c82f0e6671763c31417705e98.jpg" src="../../_images/7ba9901f6f0d479d1d79aa348e356c5f2fe1f03c82f0e6671763c31417705e98.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Consistent month-over-month improvement in successful purchase conversion</p></li>
</ul>
</section>
<section id="share-of-canceled-orders">
<h2>Share of Canceled Orders<a class="headerlink" href="#share-of-canceled-orders" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;target_share&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Share of Canceled Orders&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_tmp_df_res</span> <span class="o">=</span> <span class="n">df_orders</span><span class="p">[</span><span class="s1">&#39;order_status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">preproc</span><span class="o">.</span><span class="n">calc_target_category_share</span><span class="p">(</span>
    <span class="n">target_category</span><span class="o">=</span><span class="s1">&#39;Canceled&#39;</span>
    <span class="p">,</span> <span class="n">group_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">resample_freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_tmp_df_res</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/525c7605348b8859cd14bf6b8995ce366f209fd5472ede7cf9ce2a45666ac19c.jpg" src="../../_images/525c7605348b8859cd14bf6b8995ce366f209fd5472ede7cf9ce2a45666ac19c.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Fluctuated between 0.2% and 1.2% across months</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_tmp_df_res</span> <span class="o">=</span> <span class="n">df_orders</span><span class="p">[</span><span class="s1">&#39;order_status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">preproc</span><span class="o">.</span><span class="n">calc_target_category_share</span><span class="p">(</span>
     <span class="n">target_category</span><span class="o">=</span><span class="s1">&#39;Canceled&#39;</span>
    <span class="p">,</span> <span class="n">group_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">resample_freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_tmp_df_res</span>
    <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/edc1eb61336c55cc09918e778932149b82e69bbfcc82a181ee93dc13b05c940a.jpg" src="../../_images/edc1eb61336c55cc09918e778932149b82e69bbfcc82a181ee93dc13b05c940a.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Orders with score 1 showed significantly higher cancelation rates</p></li>
<li><p>Scores 4-5 maintained 0% cancelation rates for most months</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">tmp_tmp_df_res</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="number-of-sales">
<h2>Number of Sales<a class="headerlink" href="#number-of-sales" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;order_id&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Number of Sales&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;nunique&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/676477e0a9d05af735aea6618cd61170ee7a3126917debf019b0bd6b2109cafe.jpg" src="../../_images/676477e0a9d05af735aea6618cd61170ee7a3126917debf019b0bd6b2109cafe.jpg" />
<img alt="../../_images/9d4d8c6f3006f3e7ba117c1de785e0dd4e5d11b85e3c9f8a0d2b7c122daf01bb.jpg" src="../../_images/9d4d8c6f3006f3e7ba117c1de785e0dd4e5d11b85e3c9f8a0d2b7c122daf01bb.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>There was an anomalous peak in sales volume on November 24, 2017 - Black Friday</p></li>
<li><p>The number of sales steadily increased until November 2017, reaching a peak of approximately 7.3k orders per month. After that, sales stabilized and fluctuated in the range of 6-7k orders per month.</p></li>
</ul>
<p><strong>Monthly Growth</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">period_change</span><span class="p">(</span>
    <span class="n">period</span><span class="o">=</span><span class="s1">&#39;mom&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3e149b5b243a641c6a3e6b98958af5b72a5467d3a719d4c2184ec8a21c8192fd.jpg" src="../../_images/3e149b5b243a641c6a3e6b98958af5b72a5467d3a719d4c2184ec8a21c8192fd.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>The most significant decline in sales (more than 5% month-over-month) was observed in April, June, and December 2017, as well as in February and June 2018.</p></li>
<li><p>Conversely, the most pronounced spikes in growth (exceeding 50%) were recorded in February, March, and May 2017, and in November 2018 (Black Friday).</p></li>
<li><p>This indicates strong demand volatility in specific months, possibly linked to seasonality or marketing activities.</p></li>
</ul>
<p><strong>By Time of Day</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_time_of_day&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/caf15f7f21264208ccd7b50d4855a05cd0c386768cee8796393a4dee8137f65c.jpg" src="../../_images/caf15f7f21264208ccd7b50d4855a05cd0c386768cee8796393a4dee8137f65c.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Nighttime sales are on average lower than other times of day</p></li>
<li><p>The highest sales volume occurs in the evening</p></li>
</ul>
<p><strong>By Day of Week</strong></p>
<p>Analyzing trends by month would be incorrect, as one month might have 4 Mondays while another has 5.</p>
<p>Therefore, we’ll examine weekly patterns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">area_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_weekday&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Sales by Day of Week and Week&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/410dfcd093306e3e92444df19ce4a2dc59b1ea56d4548fe446a47da3651a2ef4.jpg" src="../../_images/410dfcd093306e3e92444df19ce4a2dc59b1ea56d4548fe446a47da3651a2ef4.jpg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">pb</span><span class="o">.</span><span class="n">time_column</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;purchase_weekday&#39;</span>
        <span class="p">,</span> <span class="n">text_auto</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Sales by Day of Week and Week&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6a4ca66841fcd7d3358c005727c46f8dabf7c37dba38aed3b0b0bbdcea0fddf0.jpg" src="../../_images/6a4ca66841fcd7d3358c005727c46f8dabf7c37dba38aed3b0b0bbdcea0fddf0.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>There’s no significant difference in sales by day of week, though weekends show slightly lower volumes</p></li>
<li><p>The peak value occurred on Black Friday</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_day_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b97e44aae09b232c4d75b36f1b56233aa5551fc62fcd36e7659755f5618c6335.jpg" src="../../_images/b97e44aae09b232c4d75b36f1b56233aa5551fc62fcd36e7659755f5618c6335.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Weekday sales grew faster than weekend sales</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e3e882c2caaab61bd3dbc4260c6b332846308a971df09d75ee6ac17130d0d4b7.jpg" src="../../_images/e3e882c2caaab61bd3dbc4260c6b332846308a971df09d75ee6ac17130d0d4b7.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Orders with 5-star reviews significantly outnumber others each month</p></li>
<li><p>Orders with 2-star reviews are consistently the least common</p></li>
<li><p>5-star orders continued growing in 2018 despite overall sales plateauing, due to declining 1-star orders</p></li>
</ul>
<p><strong>By Delivery Delay Status</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7bbceb5c39cde7adb4d081b202db2e662a9d6edab6c4bbc59a045ec647ea39cc.jpg" src="../../_images/7bbceb5c39cde7adb4d081b202db2e662a9d6edab6c4bbc59a045ec647ea39cc.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Delayed orders aren’t increasing proportionally with total orders - a positive trend</p></li>
<li><p>Peak months for delays: November 2017 (Black Friday) and March 2018</p></li>
</ul>
<p><strong>By Payment Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_total_payment_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/97ee385a11e01e3bf275317b1351a3802dbbcc8b7cbaa2343674a7ea5f73c98f.jpg" src="../../_images/97ee385a11e01e3bf275317b1351a3802dbbcc8b7cbaa2343674a7ea5f73c98f.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>The overall sales trend remains consistent across cheap, medium, and expensive orders</p></li>
</ul>
<p><strong>By Order Weight Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_total_weight_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b9b00bb4cde58bffb702eb6df3d763258a7fb739cf30819351edfdd99d54845f.jpg" src="../../_images/b9b00bb4cde58bffb702eb6df3d763258a7fb739cf30819351edfdd99d54845f.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>The overall sales trend remains consistent across light, medium, and heavy orders</p></li>
</ul>
<p><strong>By Delivery Time Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;delivery_time_days_cat&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d1f808f53db25073ae75fdcca5788f3b22deb8939c8f5b49ff312b6551df1dd8.jpg" src="../../_images/d1f808f53db25073ae75fdcca5788f3b22deb8939c8f5b49ff312b6551df1dd8.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>November 2017 saw a sharp spike in long-delivery orders (likely Black Friday effect)</p></li>
<li><p>High volumes of long deliveries persisted until March 2018</p></li>
<li><p>By August 2018, long deliveries became less common than medium and fast ones</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/25461af3278db8dbc24e5d3a82c2487012ef892569289f5f72f10a7d6d3b1f48.jpg" src="../../_images/25461af3278db8dbc24e5d3a82c2487012ef892569289f5f72f10a7d6d3b1f48.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Before 2018, non-installment orders lagged behind installment ones, but volumes equalized in 2018</p></li>
</ul>
<p><strong>By Top Customer States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_state&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/adb7d6def83bc6f086afc2d132370f019007c42edcbf33232c8b7b26f2bb13ae.jpg" src="../../_images/adb7d6def83bc6f086afc2d132370f019007c42edcbf33232c8b7b26f2bb13ae.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo state consistently led in sales volume throughout the period</p></li>
<li><p>Unlike other states, São Paulo maintained stable monthly sales in 2018</p></li>
<li><p>Rio de Janeiro and Minas Gerais ranked second and third respectively</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e7a81eab408c48098e841ea649775de63ac5ee3268cd0d4c7b5864f52c44f943.jpg" src="../../_images/e7a81eab408c48098e841ea649775de63ac5ee3268cd0d4c7b5864f52c44f943.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo city consistently had the highest sales volume</p></li>
<li><p>Rio de Janeiro ranked second</p></li>
<li><p>Unlike other cities, São Paulo showed monthly sales growth in 2018</p></li>
</ul>
</section>
<section id="sales-amount">
<h2>Sales Amount<a class="headerlink" href="#sales-amount" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;total_payment&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Sales Amount, R$&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Order Value, R$&#39;</span>
    <span class="p">,</span> <span class="n">title_base</span> <span class="o">=</span> <span class="s1">&#39;Sales Amount&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;sum&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">upper_quantile</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0bca4a3e8c4bf41eadf177478967d2078593f2282a7306400a995b6a65aade90.jpg" src="../../_images/0bca4a3e8c4bf41eadf177478967d2078593f2282a7306400a995b6a65aade90.jpg" />
<img alt="../../_images/2d72ac349f38c379c0501b4a336082b3788ba0527a36efa32a505eda60a9bb1a.jpg" src="../../_images/2d72ac349f38c379c0501b4a336082b3788ba0527a36efa32a505eda60a9bb1a.jpg" />
<img alt="../../_images/fdba9ab55d99b8cbaaa7c8c1a0d66955490b37ddffd04136993259fe1ab090ac.jpg" src="../../_images/fdba9ab55d99b8cbaaa7c8c1a0d66955490b37ddffd04136993259fe1ab090ac.jpg" />
<img alt="../../_images/26408813b8b00d8bae35789c39a30cc87554ce20facf07029478c13fb6c63f7c.jpg" src="../../_images/26408813b8b00d8bae35789c39a30cc87554ce20facf07029478c13fb6c63f7c.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>There was an anomalous peak in sales revenue on November 24, 2017 - Black Friday</p></li>
<li><p>Monthly sales revenue grew until 2018, then stabilized at 1-1.2 million R$ per month</p></li>
</ul>
<p><strong>Monthly Growth</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">period_change</span><span class="p">(</span>
    <span class="n">period</span><span class="o">=</span><span class="s1">&#39;mom&#39;</span>
    <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/62d45e66b9c49abb63f436290e543ce95d3a3604fecc4e7ad29e2788df5f827f.jpg" src="../../_images/62d45e66b9c49abb63f436290e543ce95d3a3604fecc4e7ad29e2788df5f827f.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Sales revenue dropped by more than 5% month-over-month in April, June, and December 2017, and February and June 2018</p></li>
</ul>
<p><strong>By Time of Day</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_time_of_day&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/13fca4eaf8dec230118a675bc5e55d1c71fa858ce5034e0f87f0826859b0c190.jpg" src="../../_images/13fca4eaf8dec230118a675bc5e55d1c71fa858ce5034e0f87f0826859b0c190.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Nighttime sales revenue is on average lower than other times</p></li>
<li><p>Highest revenue occurs in evenings and afternoons</p></li>
</ul>
<p><strong>By Day of Week</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">area_resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_weekday&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sales Amount by Day of the Week and Week&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/48c97ba3747a6e0cf296a2393829982fbf71044c0c1605d86fe94ea9144c09e1.jpg" src="../../_images/48c97ba3747a6e0cf296a2393829982fbf71044c0c1605d86fe94ea9144c09e1.jpg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">pb</span><span class="o">.</span><span class="n">time_column</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;purchase_weekday&#39;</span>
        <span class="p">,</span> <span class="n">text_auto</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sales Amount by Day of the Week and Week&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4f29baa200cc955c3393906c0e8503a6b592f1667d4826a46920ae54bd696166.jpg" src="../../_images/4f29baa200cc955c3393906c0e8503a6b592f1667d4826a46920ae54bd696166.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>No significant difference in revenue by day of week, though weekends are slightly lower</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_day_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/18afbe5ce9fe8b917bde095e2a4c6baa9feac66d3a8b1ef905805df07b6774bc.jpg" src="../../_images/18afbe5ce9fe8b917bde095e2a4c6baa9feac66d3a8b1ef905805df07b6774bc.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Weekday revenue grew faster than weekend revenue</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b60daa0e4d0b3603479590be3bdd467ca1fe03f5bd298f70cddd9e29e7a27bab.jpg" src="../../_images/b60daa0e4d0b3603479590be3bdd467ca1fe03f5bd298f70cddd9e29e7a27bab.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Orders with 5-star reviews generate significantly more revenue each month</p></li>
<li><p>Orders with 2-star reviews consistently generate the least revenue</p></li>
<li><p>Black Friday saw the strongest revenue spikes for both 5-star and 1-star orders</p></li>
<li><p>5-star order revenue continued growing in 2018 despite overall stagnation, partly due to declining 1-star order revenue</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f46d4d2cdb75cc8fbd8e8db13e7a9fdb9ca79204569a7b74c6c561e89c6aec89.jpg" src="../../_images/f46d4d2cdb75cc8fbd8e8db13e7a9fdb9ca79204569a7b74c6c561e89c6aec89.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Peak months for delayed order revenue: November 2017 (Black Friday) and March 2018</p></li>
</ul>
<p><strong>By Payment Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_total_payment_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cd3cf64ef411d4660e662c886fb1b3842cfc178344b3a42a2082fc075e0e5b50.jpg" src="../../_images/cd3cf64ef411d4660e662c886fb1b3842cfc178344b3a42a2082fc075e0e5b50.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>The overall revenue trend remains consistent across cheap, medium, and expensive orders</p></li>
</ul>
<p><strong>By Order Weight Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_total_weight_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/61fca8b67841fbf560b45f1802a8ee2927612832e0bd19bc93f45478eae22f6a.jpg" src="../../_images/61fca8b67841fbf560b45f1802a8ee2927612832e0bd19bc93f45478eae22f6a.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>The overall revenue trend remains consistent across light, medium, and heavy orders</p></li>
</ul>
<p><strong>By Delivery Time Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;delivery_time_days_cat&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3a3ccc90bd6a20c2d3e03489b7bfa44e67bd9995e56b614e6be6abf0dd14dcee.jpg" src="../../_images/3a3ccc90bd6a20c2d3e03489b7bfa44e67bd9995e56b614e6be6abf0dd14dcee.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>November 2017 saw a sharp spike in revenue from long-delivery orders (likely Black Friday effect)</p></li>
<li><p>High volumes of long deliveries persisted until April 2018 (unexplained by Black Friday)</p></li>
<li><p>The subsequent sharp decline in long deliveries wasn’t matched by growth in other categories</p></li>
<li><p>This may explain why overall revenue stopped growing in 2018</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d742ace525aff833ae40647ac8527f85e5f9657cbaeb11d0542fde9977493b0e.jpg" src="../../_images/d742ace525aff833ae40647ac8527f85e5f9657cbaeb11d0542fde9977493b0e.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders consistently generated higher revenue than non-installment orders</p></li>
</ul>
<p><strong>By Top Customer States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_state&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ff8d3de91286d0badd7c96e6c09b9c7fe655a2f17ee2526a686bcaa33f3b6245.jpg" src="../../_images/ff8d3de91286d0badd7c96e6c09b9c7fe655a2f17ee2526a686bcaa33f3b6245.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo state consistently led in sales revenue</p></li>
<li><p>Rio de Janeiro and Minas Gerais ranked second and third respectively</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/16d1e4dd958137c693964e60b12ad1a5acb419adf6fb7f1a3ffc81b387d5411e.jpg" src="../../_images/16d1e4dd958137c693964e60b12ad1a5acb419adf6fb7f1a3ffc81b387d5411e.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo city consistently generated the highest sales revenue</p></li>
<li><p>Rio de Janeiro ranked second</p></li>
</ul>
<p><strong>By Payment Type</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_payment_types&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/581f746401f0e16630d7f62ca741add7d84fb85f8c8eeb97ac0568a2ed8cccf3.jpg" src="../../_images/581f746401f0e16630d7f62ca741add7d84fb85f8c8eeb97ac0568a2ed8cccf3.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Credit card payments consistently generated the highest revenue, with boleto second</p></li>
<li><p>Debit card payment revenue grew from June 2018</p></li>
</ul>
<p><strong>By Product Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_general_product_categories&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/56002f59bf91000bb4dfd6b9163a9235454fbb13156d552b693562ce739d45cb.jpg" src="../../_images/56002f59bf91000bb4dfd6b9163a9235454fbb13156d552b693562ce739d45cb.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Electronics consistently generated the highest revenue, followed by furniture</p></li>
<li><p>‘Beauty/Health’ and ‘Home/Garden’ categories continued growing in 2018 while others slowed or declined</p></li>
</ul>
</section>
<section id="average-order-value">
<h2>Average Order Value<a class="headerlink" href="#average-order-value" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;total_payment&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Order Value, R$&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Order Value, R$&#39;</span>
    <span class="p">,</span> <span class="n">title_base</span> <span class="o">=</span> <span class="s1">&#39;Average Order Value&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ed1a1e2450ec41bee097200f5cc4b55f26ab531adf91575b1130d8be6aeaa05f.jpg" src="../../_images/ed1a1e2450ec41bee097200f5cc4b55f26ab531adf91575b1130d8be6aeaa05f.jpg" />
<img alt="../../_images/1d56efad0013e5d0e9e4d16a826238563543a8f2f994f98355a13fec08a43146.jpg" src="../../_images/1d56efad0013e5d0e9e4d16a826238563543a8f2f994f98355a13fec08a43146.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>The average order value fluctuates between 100-250 R$ daily</p></li>
<li><p>Black Friday didn’t show a spike in average order value</p></li>
<li><p>Monthly average order value remains stable at 150-170 R$ without growth</p></li>
</ul>
<p><strong>Monthly Growth</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">period_change</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="s1">&#39;mom&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5578624a6a4319673f22a929abd74bb53b21cfff0c4636e439130040bdce4a2e.jpg" src="../../_images/5578624a6a4319673f22a929abd74bb53b21cfff0c4636e439130040bdce4a2e.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average order value dropped &gt;5% month-over-month in May, July, November 2017 and August 2018</p></li>
</ul>
<p><strong>By Time of Day</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_time_of_day&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/53e47b81b6d55d398cedbc2bc636d139960e889f2439a24148015ebe2c44ed13.jpg" src="../../_images/53e47b81b6d55d398cedbc2bc636d139960e889f2439a24148015ebe2c44ed13.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>No significant difference in average order value by time of day</p></li>
<li><p>Nighttime averages are slightly lower</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f9b2ef777c1b855e7b4a164c887545621f6d993f911046d538cb2f78446bb6d3.jpg" src="../../_images/f9b2ef777c1b855e7b4a164c887545621f6d993f911046d538cb2f78446bb6d3.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>June 2017 saw a major peak in average value for delayed orders</p></li>
<li><p>Smaller peaks occurred in April/December 2017 and January/June 2018</p></li>
</ul>
<p><strong>By Order Weight Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_total_weight_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3424be83a16857a4d3559f5950c1cd4021089f5d36639183beca8b5615937555.jpg" src="../../_images/3424be83a16857a4d3559f5950c1cd4021089f5d36639183beca8b5615937555.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Heavy orders show more variability in average value over time</p></li>
<li><p>Consistently: heavy &gt; medium &gt; light order values</p></li>
<li><p>April-July 2017 saw significant decline in heavy order values, followed by fluctuating growth</p></li>
</ul>
<p><strong>By Delivery Time Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;delivery_time_days_cat&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/71e15d295b65836649366e76bad8273f6c9e3890a8f50d0ecde6ea02a9a4d26f.jpg" src="../../_images/71e15d295b65836649366e76bad8273f6c9e3890a8f50d0ecde6ea02a9a4d26f.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>For most months, expensive items had longer delivery times</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b4cc9225db3b9387659eeea8451f13fe22f906e3b22d89a62e2b86d837037a87.jpg" src="../../_images/b4cc9225db3b9387659eeea8451f13fe22f906e3b22d89a62e2b86d837037a87.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders consistently show higher average values (logical as customers can afford more)</p></li>
<li><p>Installment order values fluctuate more over time</p></li>
<li><p>Pre-July 2017: steady decline in installment order values</p></li>
<li><p>Post-July 2017: fluctuating growth</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/26a6354c14c0d825294a8a9bfc3bce70e8d383a7251e9b59d6ea88c730c30197.jpg" src="../../_images/26a6354c14c0d825294a8a9bfc3bce70e8d383a7251e9b59d6ea88c730c30197.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Orders with 1-star reviews typically had higher average values</p></li>
<li><p>Orders with 2-star reviews often had higher values than 3/4/5-star orders</p></li>
<li><p>Conclusion: lower ratings were more common for higher-value orders</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2ba00c99ff322812e9cf0def321c871c60a7b8761d0e47163dbd23bc05b0aa34.jpg" src="../../_images/2ba00c99ff322812e9cf0def321c871c60a7b8761d0e47163dbd23bc05b0aa34.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>February 2017 saw a major spike in Brasília’s average order value</p></li>
<li><p>Otherwise, top 5 cities show similar average values</p></li>
</ul>
</section>
<section id="number-of-purchases-per-customer-per-week">
<h2>Number of Purchases per Customer per Week<a class="headerlink" href="#number-of-purchases-per-customer-per-week" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;customer_unique_id&#39;</span><span class="p">])[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
          <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
          <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;order_cnt&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;weeks_in_month_cnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="o">.</span><span class="n">order_purchase_dt</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days_in_month</span> <span class="o">/</span> <span class="mi">7</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;avg_orders_per_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;order_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;weeks_in_month_cnt&#39;</span><span class="p">]</span>
<span class="n">tmp_df_res</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;order_cnt&#39;</span><span class="p">,</span> <span class="s1">&#39;weeks_in_month_cnt&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tmp_df_res</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;avg_orders_per_week&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>order_purchase_dt</th>
      <th>customer_unique_id</th>
      <th>avg_orders_per_week</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>62</th>
      <td>2017-01-31</td>
      <td>12f5d6e1cbf93dafd9dcc19095df0b3d</td>
      <td>1.35</td>
    </tr>
    <tr>
      <th>1722</th>
      <td>2017-02-28</td>
      <td>a239b8e2fbce33780f1f1912e2ee5275</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>51293</th>
      <td>2018-02-28</td>
      <td>3e43e6105506432c953e165fb2acf44c</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>54267</th>
      <td>2018-02-28</td>
      <td>b4e4f24de1e8725b74e4a1f4975116ed</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>24422</th>
      <td>2017-09-30</td>
      <td>b08fab27d47a1eb6deda07bfd965ad43</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>5199</th>
      <td>2017-04-30</td>
      <td>25a560b9a6006157838aab1bdbd68624</td>
      <td>0.93</td>
    </tr>
    <tr>
      <th>375</th>
      <td>2017-01-31</td>
      <td>83e7958a94bd7f74a9414d8782f87628</td>
      <td>0.90</td>
    </tr>
    <tr>
      <th>93685</th>
      <td>2018-08-31</td>
      <td>c8460e4251689ba205045f3ea17884a1</td>
      <td>0.90</td>
    </tr>
    <tr>
      <th>55050</th>
      <td>2018-02-28</td>
      <td>d3882d7abd0c66064d740d7ed04dd1ef</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>54211</th>
      <td>2018-02-28</td>
      <td>b2bd387fdc3cf05931f0f897d607dc88</td>
      <td>0.75</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>User ‘12f5d6e1cbf93dafd9dcc19095df0b3d’ had the highest weekly purchase frequency (January 2017)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">avg_orders_per_week</span> <span class="o">=</span> <span class="s1">&#39;Average number of sales per week&#39;</span>
<span class="p">))</span>
<span class="n">tmp_df_res</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
          <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
          <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
          <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
          <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Average number of sales per week by month&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/049238391b86497ac576e12f2d144257dae9ec515254680d33ff72e063ed41e4.jpg" src="../../_images/049238391b86497ac576e12f2d144257dae9ec515254680d33ff72e063ed41e4.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average weekly purchases per customer remains stable at 0.23-0.25</p></li>
</ul>
</section>
<section id="arppu">
<h2>ARPPU<a class="headerlink" href="#arppu" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;arppu&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;ARPPU, R$&#39;</span>
    <span class="p">,</span> <span class="n">title_base</span> <span class="o">=</span> <span class="s1">&#39;ARPPU&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_days</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;ARPPU by day&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_days</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ffd91e8b2584a1b8b678b99ddf1b18370e6f1731bd87dcf91484eec15435e212.jpg" src="../../_images/ffd91e8b2584a1b8b678b99ddf1b18370e6f1731bd87dcf91484eec15435e212.jpg" />
<img alt="../../_images/96b67f65ca73bdf1e740a5aa1693048989d1a8c4ab953bb7697cc84c0662d400.jpg" src="../../_images/96b67f65ca73bdf1e740a5aa1693048989d1a8c4ab953bb7697cc84c0662d400.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>ARPPU fluctuates daily between 100-250 R$</p></li>
<li><p>No Black Friday spike in ARPPU</p></li>
<li><p>Monthly ARPPU remains stable at 130-150 R$</p></li>
</ul>
<p><strong>By Time of Day</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;purchase_time_of_day&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_time_of_day&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2296f49732621c0247b7d74d6b65b778ae0cf5b9afd330974f5afa3a69c76c64.jpg" src="../../_images/2296f49732621c0247b7d74d6b65b778ae0cf5b9afd330974f5afa3a69c76c64.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>No significant ARPPU differences by time of day</p></li>
<li><p>Nighttime ARPPU slightly lower</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Since the review score does not have a categorical type, we might lose groups with no data after grouping.</p>
<p>Let’s restore the dates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="o">.</span><span class="n">preproc</span><span class="o">.</span><span class="n">restore_full_index</span><span class="p">(</span>
    <span class="n">date_cols</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">group_cols</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/445aa3419a3fa137384a3348374fd1fee6a70ba91d7fe72e2da5c33301c7788d.jpg" src="../../_images/445aa3419a3fa137384a3348374fd1fee6a70ba91d7fe72e2da5c33301c7788d.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>1-star review orders typically had higher ARPPU</p></li>
<li><p>2-star orders often had higher ARPPU than 3/4/5-star orders</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;is_delayed&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/339a7513647c2ea8f5c71ad8b0f6f5da3dd8cb34ca4bb4ae0384baea8496825d.jpg" src="../../_images/339a7513647c2ea8f5c71ad8b0f6f5da3dd8cb34ca4bb4ae0384baea8496825d.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>June 2017 saw major ARPPU peak for delayed orders</p></li>
<li><p>Smaller peaks in April/December 2017 and January/June 2018</p></li>
</ul>
<p><strong>By Order Weight Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;order_total_weight_cat&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_total_weight_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f9fc16b9b7c353cab71b4f4d262a28c667594186d47d3331f9e41d2c61b33d02.jpg" src="../../_images/f9fc16b9b7c353cab71b4f4d262a28c667594186d47d3331f9e41d2c61b33d02.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Heavy orders show more ARPPU variability</p></li>
<li><p>Consistently: heavy &gt; medium &gt; light order ARPPU</p></li>
<li><p>April-July 2017: significant heavy order ARPPU decline, then fluctuating growth</p></li>
</ul>
<p><strong>By Delivery Time Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;delivery_time_days_cat&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;delivery_time_days_cat&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8956a9afb6657c52ff09e321d26ac8b89664a53b5968f43457a8ad7bb51adf70.jpg" src="../../_images/8956a9afb6657c52ff09e321d26ac8b89664a53b5968f43457a8ad7bb51adf70.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Higher ARPPU typically correlates with longer delivery times</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;order_has_installment&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0d5af834f6764e51ec5f06911667c96967de4c2f6ea2a9f5626eb76006f879ef.jpg" src="../../_images/0d5af834f6764e51ec5f06911667c96967de4c2f6ea2a9f5626eb76006f879ef.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders consistently show higher ARPPU</p></li>
<li><p>More ARPPU variability for installment orders</p></li>
<li><p>Pre-July 2017: steady ARPPU decline for installments</p></li>
<li><p>Post-July 2017: fluctuating growth</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<p>Since there are cities with very few sales, we will select the top 5 cities by sales volume.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_cities</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;customer_city&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
    <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">customer_city</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_cities</span><span class="p">)]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;customer_city&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">:</span> <span class="s1">&#39;nunique&#39;</span><span class="p">,</span> <span class="s1">&#39;total_products_price&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;arppu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_products_price&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/56b5c6110ae014cfe55d1faf0a845bbdb0e442cad41f5e849a57c81c48953d01.jpg" src="../../_images/56b5c6110ae014cfe55d1faf0a845bbdb0e442cad41f5e849a57c81c48953d01.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>February 2017: major ARPPU spike in Brasília</p></li>
<li><p>Otherwise minimal differences among top 5 cities</p></li>
</ul>
</section>
<section id="number-of-customers">
<h2>Number of Customers<a class="headerlink" href="#number-of-customers" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;customer_unique_id&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Number of Customers&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;nunique&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d5391932a4d14a57edd68057ab96d2147ddd432db052faf63762ccc35096eb70.jpg" src="../../_images/d5391932a4d14a57edd68057ab96d2147ddd432db052faf63762ccc35096eb70.jpg" />
<img alt="../../_images/68101c50490fac06d7233d3ad0258a96d71bc6c324679611c88d10ccbcce6c42.jpg" src="../../_images/68101c50490fac06d7233d3ad0258a96d71bc6c324679611c88d10ccbcce6c42.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Black Friday (Nov 24, 2017) saw anomalous customer count peak</p></li>
<li><p>Customer growth continued until 2018, then stabilized at 6-7k monthly</p></li>
</ul>
<p><strong>Monthly Growth</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">period_change</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="s1">&#39;mom&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1094d42e43af89332c33f2eaef44fc0ba0a9f982fdd00042c8bb973bcd22ef64.jpg" src="../../_images/1094d42e43af89332c33f2eaef44fc0ba0a9f982fdd00042c8bb973bcd22ef64.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Customer counts dropped &gt;5% month-over-month in April/June/December 2017 and February/June 2018</p></li>
</ul>
<p><strong>By Time of Day</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_time_of_day&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/addf3834143df35f5399f6472378b8dd3677d17b33bc2e63e380ef44b56306ac.jpg" src="../../_images/addf3834143df35f5399f6472378b8dd3677d17b33bc2e63e380ef44b56306ac.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Fewer customers at night</p></li>
<li><p>Evening sees most customer activity</p></li>
</ul>
<p><strong>By Day of Week</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">area_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_weekday&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Sales by Day of Week and Week&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c304a376458f08e27509dbe5108346c43176da7440532fa99c1b4bde6f9ff761.jpg" src="../../_images/c304a376458f08e27509dbe5108346c43176da7440532fa99c1b4bde6f9ff761.jpg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">pb</span><span class="o">.</span><span class="n">time_column</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;purchase_weekday&#39;</span>
        <span class="p">,</span> <span class="n">text_auto</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Sales by Day of Week and Week&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a552150d94578695d75c5b7fdb60987acdc72536431ec3f5d60f3fbc21923a01.jpg" src="../../_images/a552150d94578695d75c5b7fdb60987acdc72536431ec3f5d60f3fbc21923a01.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Minimal weekday/weekend customer count differences</p></li>
<li><p>Weekends slightly lower</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_day_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/43ee3dd7a40f15ead5af61a9cca832f1e9031b01aec7bc96c63be133a1661f5a.jpg" src="../../_images/43ee3dd7a40f15ead5af61a9cca832f1e9031b01aec7bc96c63be133a1661f5a.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Weekday customer growth outpaced weekends</p></li>
</ul>
<p><strong>By Top Customer States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_state&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/80c5bb7f0a0e5de0c0c970dec2a94fc905e9751b533e626ada1504bc9a8a662b.jpg" src="../../_images/80c5bb7f0a0e5de0c0c970dec2a94fc905e9751b533e626ada1504bc9a8a662b.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo consistently led in customer counts</p></li>
<li><p>Unlike other states, maintained 2018 customer levels</p></li>
<li><p>Rio de Janeiro and Minas Gerais ranked 2nd/3rd</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9d7a9edad24f00f7b54657ea977013094f07acf0e8faadf6e39146f807f4dc2e.jpg" src="../../_images/9d7a9edad24f00f7b54657ea977013094f07acf0e8faadf6e39146f807f4dc2e.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo city consistently had most customers</p></li>
<li><p>Rio de Janeiro ranked second</p></li>
<li><p>Only São Paulo showed 2018 monthly growth</p></li>
</ul>
</section>
<section id="share-of-new-customers">
<h2>Share of New Customers<a class="headerlink" href="#share-of-new-customers" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;new_customers_share&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Share of New Customers&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
    <span class="p">,</span> <span class="n">update_fig</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;tickformat&#39;</span><span class="p">:</span> <span class="s1">&#39;.1%&#39;</span><span class="p">}}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<p>Since one customer could make multiple orders at the same time, we need to remove such duplicates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span><span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                  <span class="n">new_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                  <span class="n">all_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
              <span class="p">)</span>
              <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_customers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_days</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Share of New Customers by Day&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span><span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                  <span class="n">new_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                  <span class="n">all_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
              <span class="p">)</span>
              <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_customers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_days</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0221c4c76f2d32737b69edba39008fbfcca57c4a8e143da17581d83590922a66.jpg" src="../../_images/0221c4c76f2d32737b69edba39008fbfcca57c4a8e143da17581d83590922a66.jpg" />
<img alt="../../_images/eb3c3c76bda76ff0547e9f22c0f6a3bc912839d2db849af8bbca2485d7d77e5f.jpg" src="../../_images/eb3c3c76bda76ff0547e9f22c0f6a3bc912839d2db849af8bbca2485d7d77e5f.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Daily new customer share never fell below 92%</p></li>
<li><p>Monthly new customer share gradually declined (still &gt;97%)</p></li>
<li><p>Nearly all active customers are new</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span><span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;purchase_day_type&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;purchase_day_type&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
               <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                   <span class="n">new_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                   <span class="n">all_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
               <span class="p">)</span>
               <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_customers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_day_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7b7aebdf6ac2170e68c49d310682970c933b6a2cd896b519cbec74e442afb71d.jpg" src="../../_images/7b7aebdf6ac2170e68c49d310682970c933b6a2cd896b519cbec74e442afb71d.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Weekend new customer share fluctuates more than weekdays</p></li>
<li><p>Weekends typically have lower new customer share</p></li>
</ul>
<p><strong>By Top Customer States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_states</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;customer_state&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
              <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
              <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
              <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">customer_state</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_states</span><span class="p">)]</span>
              <span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_state&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;customer_state&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
               <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                   <span class="n">new_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                   <span class="n">all_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
               <span class="p">)</span>
               <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_customers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_state&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b65bd6d102a26bc4a51f2dc2dcdada7b3bbca21e7a8587bb2f50f916d5d6f07c.jpg" src="../../_images/b65bd6d102a26bc4a51f2dc2dcdada7b3bbca21e7a8587bb2f50f916d5d6f07c.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Minimal state-level differences in new customer share</p></li>
<li><p>Rio Grande do Sul showed more variability</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;customer_city&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
              <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
              <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
              <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_sales</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">customer_city</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_cities</span><span class="p">)]</span>
              <span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;customer_city&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;customer_city&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
               <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                   <span class="n">new_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sale_is_customer_first_purchase&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                   <span class="n">all_customers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
               <span class="p">)</span>
               <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_customers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_customers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/deb6b2d2ba9662bf6f71b9548d023bdf7cea90f0e8ab146a8de798e1a3f9bc86.jpg" src="../../_images/deb6b2d2ba9662bf6f71b9548d023bdf7cea90f0e8ab146a8de798e1a3f9bc86.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo and Rio de Janeiro show less monthly fluctuation in new customer share</p></li>
</ul>
</section>
<section id="number-of-sellers">
<h2>Number of Sellers<a class="headerlink" href="#number-of-sellers" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_sales_sellers</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_items</span><span class="p">[[</span><span class="s1">&#39;order_id&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_id&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_sellers</span><span class="p">[[</span><span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_state&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_city&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tmp_df_sales_sellers</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;seller_id&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Number of Sellers&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;nunique&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b663511956d60d7161385cf0d914fb9984a2e6c3fb107e5db79c9bf148815fed.jpg" src="../../_images/b663511956d60d7161385cf0d914fb9984a2e6c3fb107e5db79c9bf148815fed.jpg" />
<img alt="../../_images/acb839403fec558dc6e5f6dc36a05dca0736aae19e63b21ee9f3a3b980a38b7e.jpg" src="../../_images/acb839403fec558dc6e5f6dc36a05dca0736aae19e63b21ee9f3a3b980a38b7e.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Black Friday (Nov 24, 2017) saw anomalous seller count peak</p></li>
<li><p>Monthly seller counts show steady growth</p></li>
</ul>
<p><strong>By Time of Day</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_time_of_day&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0f71cb0a1b6318f2c19939bc3dd4f593cdd1cd33b0fef8131033591111148cae.jpg" src="../../_images/0f71cb0a1b6318f2c19939bc3dd4f593cdd1cd33b0fef8131033591111148cae.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Fewer active sellers at night</p></li>
<li><p>Evening/afternoon see most seller activity</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_day_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8fde50dc7f009916da81e1719b3ba814e845b426c50aacb32ce6aee30f85b2d4.jpg" src="../../_images/8fde50dc7f009916da81e1719b3ba814e845b426c50aacb32ce6aee30f85b2d4.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Weekday seller growth outpaced weekends</p></li>
</ul>
<p><strong>By Top Seller States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;seller_state&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1b9e589c84fcbeb78d922816b87d10afd5c15bb1e644d13470e6935857d22a26.jpg" src="../../_images/1b9e589c84fcbeb78d922816b87d10afd5c15bb1e644d13470e6935857d22a26.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo consistently led in seller counts with strongest growth</p></li>
<li><p>Paraná and Minas Gerais ranked 2nd/3rd</p></li>
<li><p>All top 5 states showed steady seller growth</p></li>
</ul>
<p><strong>By Top Seller Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;seller_city&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/18d14f88dbe19fff17c58c01eb2a3579ccd65af438ee8eca245dafbb57f68c69.jpg" src="../../_images/18d14f88dbe19fff17c58c01eb2a3579ccd65af438ee8eca245dafbb57f68c69.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo city consistently had most sellers with strongest growth</p></li>
<li><p>Curitiba ranked second</p></li>
</ul>
</section>
<section id="share-of-new-sellers">
<h2>Share of New Sellers<a class="headerlink" href="#share-of-new-sellers" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;new_sellers_share&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Share of New Sellers&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
    <span class="p">,</span> <span class="n">update_fig</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;tickformat&#39;</span><span class="p">:</span> <span class="s1">&#39;.1%&#39;</span><span class="p">}}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;seller_first_order_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_sales_sellers</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;seller_id&#39;</span><span class="p">)[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;seller_first_order_dt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<p>Since one seller could appear in multiple orders at the same time in the first order, we need to remove such duplicates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                  <span class="n">new_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                  <span class="n">all_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
              <span class="p">)</span>
              <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_sellers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_days</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span>
               <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Share of New Sellers by Day&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                  <span class="n">new_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                  <span class="n">all_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
              <span class="p">)</span>
              <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_sellers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_days</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d0e28ea1a6b4d9b80d64b7e2ca764560f31a73f465b6fe33994f9ff153765f36.jpg" src="../../_images/d0e28ea1a6b4d9b80d64b7e2ca764560f31a73f465b6fe33994f9ff153765f36.jpg" />
<img alt="../../_images/1e8bcb9009135e06ccfc6505add4fd633348560cb6352ecacec3bff2a33a263a.jpg" src="../../_images/1e8bcb9009135e06ccfc6505add4fd633348560cb6352ecacec3bff2a33a263a.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>New seller share declined until June 2017</p></li>
<li><p>Stabilized at 10-20% thereafter</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">,</span> <span class="s1">&#39;purchase_day_type&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;purchase_day_type&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                  <span class="n">new_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                  <span class="n">all_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
              <span class="p">)</span>
              <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_sellers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purchase_day_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7f880c11572474871a27865c10c3f3505480637d61a40874d5f5f65c9b5bed1d.jpg" src="../../_images/7f880c11572474871a27865c10c3f3505480637d61a40874d5f5f65c9b5bed1d.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Weekends consistently had lower new seller share than weekdays</p></li>
</ul>
<p><strong>By Top Seller States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_states</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;seller_state&#39;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
              <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
              <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
              <span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">seller_state</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_states</span><span class="p">)]</span>
              <span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">,</span> <span class="s1">&#39;seller_state&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
              <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;seller_state&#39;</span><span class="p">],</span> <span class="n">observed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
               <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                  <span class="n">new_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;is_seller_first_order&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">),</span>
                  <span class="n">all_sellers_cnt</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;seller_id&#39;</span><span class="p">,</span> <span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
               <span class="p">)</span>
               <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_share&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;new_sellers_cnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;all_sellers_cnt&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">tmp_df_res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;seller_state&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/00dfafa9f3091ad0a0099e90fd5f33f71467cce5455f44f3eed21681b79cfd68.jpg" src="../../_images/00dfafa9f3091ad0a0099e90fd5f33f71467cce5455f44f3eed21681b79cfd68.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Minimal state-level differences in new seller share</p></li>
<li><p>Minas Gerais often slightly lower</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">tmp_df_res</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ratio-of-number-of-sellers-and-customers">
<h2>Ratio of Number of Sellers and Customers<a class="headerlink" href="#ratio-of-number-of-sellers-and-customers" title="Link to this heading">#</a></h2>
<p><strong>Active Sellers and Customers</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">customers_cnt_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
                 <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
                 <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">sellers_cnt_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)[</span><span class="s1">&#39;seller_id&#39;</span><span class="p">]</span>
                 <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
                 <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span> <span class="o">=</span> <span class="n">customers_cnt_all</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sellers_cnt_all</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;seller_customer_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;seller_id&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">seller_customer_ratio</span> <span class="o">=</span> <span class="s1">&#39;Ratio of Number of Sellers and Customers&#39;</span>
<span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ratio of Number of Sellers and Customers by Month&#39;</span>
<span class="p">)</span>
<span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/00352188d3a24a41a5566b79812c4e951da6d8d54c475c81bc075e8dacef60f3.jpg" src="../../_images/00352188d3a24a41a5566b79812c4e951da6d8d54c475c81bc075e8dacef60f3.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Pre-November 2017: customer growth outpaced sellers</p></li>
<li><p>Post-November 2017: reversed trend</p></li>
</ul>
<p><strong>New Sellers and Customers</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;first_order_customer_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_sales_sellers</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">)[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;is_first_month_for_customer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;first_order_customer_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;first_order_customer_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;first_order_seller_dt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_sales_sellers</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;seller_id&#39;</span><span class="p">)[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;is_first_month_for_seller&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;first_order_seller_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="s1">&#39;first_order_seller_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">customers_cnt_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="n">tmp_df_sales_sellers</span><span class="o">.</span><span class="n">is_first_month_for_customer</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">]</span>
                 <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
                 <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">sellers_cnt_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales_sellers</span><span class="p">[</span><span class="n">tmp_df_sales_sellers</span><span class="o">.</span><span class="n">is_first_month_for_seller</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">)[</span><span class="s1">&#39;seller_id&#39;</span><span class="p">]</span>
                 <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
                 <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span> <span class="o">=</span> <span class="n">customers_cnt_new</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sellers_cnt_new</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;seller_customer_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;seller_id&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;customer_unique_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">seller_customer_ratio</span> <span class="o">=</span> <span class="s1">&#39;Ratio of New Sellers and New Customers&#39;</span>
<span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ratio of Number of New Sellers and Number of New Customers by Month&#39;</span>
<span class="p">)</span>
<span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/beb5399e52d85e245dfe06ad40bc34e3a68c12ebf434d0a0b39ac5c43a789962.jpg" src="../../_images/beb5399e52d85e245dfe06ad40bc34e3a68c12ebf434d0a0b39ac5c43a789962.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Pre-July 2017: stronger new customer growth</p></li>
<li><p>Post-July 2017: similar growth rates for new customers/sellers</p></li>
</ul>
</section>
<section id="number-of-orders-per-customer">
<h2>Number of Orders per Customer<a class="headerlink" href="#number-of-orders-per-customer" title="Link to this heading">#</a></h2>
<p><strong>By month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="s1">&#39;customer_unique_id&#39;</span><span class="p">])[</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">order_id</span> <span class="o">=</span> <span class="s1">&#39;Average Number of Orders per Customer&#39;</span>
<span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>          
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Average Number of Orders per Customer by Month&#39;</span>
<span class="p">)</span>
<span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6641ecf4517290e2b1b7d8ec986d707d0c79c6f4414d9b4df590dbb6af18c007.jpg" src="../../_images/6641ecf4517290e2b1b7d8ec986d707d0c79c6f4414d9b4df590dbb6af18c007.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>The average number of orders per user fluctuates around 1 throughout the entire period.</p></li>
</ul>
</section>
<section id="number-of-reviews">
<h2>Number of Reviews<a class="headerlink" href="#number-of-reviews" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_reviews</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;review_creation_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;review_id&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Number of Reviews&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;nunique&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/205cf08218ca39043adb8f166e7d78fdfe9daf32d228e991a65755bf4d4dff82.jpg" src="../../_images/205cf08218ca39043adb8f166e7d78fdfe9daf32d228e991a65755bf4d4dff82.jpg" />
<img alt="../../_images/f6540f5872c38436f783e1d3d9983fb21c947a656768c4d078730f84248baed0.jpg" src="../../_images/f6540f5872c38436f783e1d3d9983fb21c947a656768c4d078730f84248baed0.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Daily review counts fluctuate significantly with extreme drops</p></li>
<li><p>Reviews may not be recorded daily but in batches</p></li>
<li><p>Review counts grew steadily until 2018, then stabilized at 6-8k monthly</p></li>
</ul>
<p><strong>By Day of Week</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">area_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;review_creation_weekday&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Reviews by Day of Week and Week&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/623c1ce459670205951f645c84ab95198cd937dd13e65341757d6ed5c1688d32.jpg" src="../../_images/623c1ce459670205951f645c84ab95198cd937dd13e65341757d6ed5c1688d32.jpg" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">pb</span><span class="o">.</span><span class="n">time_column</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;review_creation_weekday&#39;</span>
        <span class="p">,</span> <span class="n">text_auto</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Number of Reviews by Day of Week and Week&#39;</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8b6906dbcda14518c78712bf5bea7091eec9df9decbc9775804a198817289a41.jpg" src="../../_images/8b6906dbcda14518c78712bf5bea7091eec9df9decbc9775804a198817289a41.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Significantly fewer reviews created on Mondays/Sundays</p></li>
<li><p>Minimal differences between other weekdays</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;review_day_type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8e8a2772e026c3a066aa9b965bf3f2809aff75e7d55b4f1e826eadf08b382072.jpg" src="../../_images/8e8a2772e026c3a066aa9b965bf3f2809aff75e7d55b4f1e826eadf08b382072.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Workdays consistently generate more reviews than weekends</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;review_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d04c46278c492980572423ed3494f2bb9aec14697a0d28c1b824f1546f477183.jpg" src="../../_images/d04c46278c492980572423ed3494f2bb9aec14697a0d28c1b824f1546f477183.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>5-star reviews significantly outnumber others monthly</p></li>
<li><p>2-star reviews are consistently the least common</p></li>
<li><p>More 1-star reviews than 2/3-star reviews</p></li>
</ul>
</section>
<section id="review-score">
<h2>Review Score<a class="headerlink" href="#review-score" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_reviews</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;review_creation_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;review_score&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Review Score&#39;</span>      
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b3d65e81d6252e49fcff6dfbd1797e544d2811f770debbd35a21c25f5db1ca2b.jpg" src="../../_images/b3d65e81d6252e49fcff6dfbd1797e544d2811f770debbd35a21c25f5db1ca2b.jpg" />
<img alt="../../_images/c5f0e18f41afd9f0a93c238bae97191c5dcc661f56b6c43d655f8583fa3c9e21.jpg" src="../../_images/c5f0e18f41afd9f0a93c238bae97191c5dcc661f56b6c43d655f8583fa3c9e21.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Daily average review scores fluctuate wildly (3-5)</p></li>
<li><p>Monthly averages declined from August 2017 to March 2018, then spiked</p></li>
</ul>
<p><strong>By Weekday vs Weekend</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;review_day_type&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b6a9f7e70c3e93a077bc22bc0f83210822bf3f057eb3d29b90e4befae50525a4.jpg" src="../../_images/b6a9f7e70c3e93a077bc22bc0f83210822bf3f057eb3d29b90e4befae50525a4.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Workdays consistently have higher average review scores than weekends</p></li>
</ul>
</section>
<section id="nps">
<h2>NPS<a class="headerlink" href="#nps" title="Link to this heading">#</a></h2>
<p>For calculating NPS, we will divide customers into the following groups:</p>
<ul class="simple">
<li><p>Promoters: customers who gave a rating of 5</p></li>
<li><p>Passive: customers who gave a rating of 4</p></li>
<li><p>Detractors: customers who gave a rating of 1-3</p></li>
</ul>
<p>Let’s look at how NPS changed by month.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_res</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_reviews</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;review_creation_dt&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;review_score&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;review_id&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;nunique&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_responses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;promoters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;detractors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;nps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;promoters&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;detractors&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">tmp_df_res</span><span class="p">[</span><span class="s1">&#39;total_responses&#39;</span><span class="p">]</span>
<span class="n">tmp_df_res</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">review_creation_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">nps</span> <span class="o">=</span> <span class="s1">&#39;NPS&#39;</span>
<span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tmp_df_res</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;NPS by month&#39;</span>
<span class="p">)</span>
<span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e36bc726065a40c938b308578e048d9e57a70cbb975ea2fd1bea7bfa87640769.jpg" src="../../_images/e36bc726065a40c938b308578e048d9e57a70cbb975ea2fd1bea7bfa87640769.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>NPS remains satisfactory (0-49) throughout</p></li>
<li><p>Many neutral customers, few critical issues</p></li>
<li><p>Significant NPS drop in March 2018</p></li>
</ul>
</section>
<section id="freight-cost-ratio">
<h2>Freight Cost Ratio<a class="headerlink" href="#freight-cost-ratio" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;freight_ratio&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Freight Cost Ratio&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
    <span class="p">,</span> <span class="n">update_fig</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;yaxis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;tickformat&#39;</span><span class="p">:</span> <span class="s1">&#39;.1%&#39;</span><span class="p">}}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5e9c0206305c59d0981203b45dc6efe8d5628cba39719b01af35744b22af21ef.jpg" src="../../_images/5e9c0206305c59d0981203b45dc6efe8d5628cba39719b01af35744b22af21ef.jpg" />
<img alt="../../_images/286a15b9eb0f2cdf28edbe0c5764769f60de370c561fd70c30daf26e8c8d3867.jpg" src="../../_images/286a15b9eb0f2cdf28edbe0c5764769f60de370c561fd70c30daf26e8c8d3867.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Shipping cost share of order value remains stable (0.2-0.22)</p></li>
</ul>
<p><strong>By Order Weight Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_total_weight_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/df825e6777d6b70c30763e57befc8befcc3cfd3a54e1967be60b2a7d6a0cadb6.jpg" src="../../_images/df825e6777d6b70c30763e57befc8befcc3cfd3a54e1967be60b2a7d6a0cadb6.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Light items have higher shipping cost share than medium/heavy</p></li>
<li><p>Minimal difference between medium/heavy items</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e3174dd1e9783fa8cfbeb2a9145c4b458757aeefeb9605a4cf59f56b219c6433.jpg" src="../../_images/e3174dd1e9783fa8cfbeb2a9145c4b458757aeefeb9605a4cf59f56b219c6433.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders consistently have lower shipping cost share</p></li>
</ul>
<p><strong>By Top Customer States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_state&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/48668f3d3e10e9ba013c7ff4d7cffbc6aba621697c7ab28dd1f97db228442047.jpg" src="../../_images/48668f3d3e10e9ba013c7ff4d7cffbc6aba621697c7ab28dd1f97db228442047.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo consistently has lowest shipping cost share among top states</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4e015fe38dbe3b64e715892aaf4affff4713aee94dfe399b7f4ee71f76f3cad1.jpg" src="../../_images/4e015fe38dbe3b64e715892aaf4affff4713aee94dfe399b7f4ee71f76f3cad1.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo city usually has lowest shipping cost share among top cities</p></li>
</ul>
</section>
<section id="delivery-time">
<h2>Delivery Time<a class="headerlink" href="#delivery-time" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;delivery_time_days&#39;</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;delivery_time_days&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Delivery Time, days&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Delivery Time, days&#39;</span>     
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">upper_quantile</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span>
        <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
        <span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/848fb0a55b08703b797d6060fc69e5afcdb533c072167d86d71c199fba96cf46.jpg" src="../../_images/848fb0a55b08703b797d6060fc69e5afcdb533c072167d86d71c199fba96cf46.jpg" />
<img alt="../../_images/2efde2141afc25cc116b03f9b216bf02424a293442c3c2c537c05d7eb5f0a6e8.jpg" src="../../_images/2efde2141afc25cc116b03f9b216bf02424a293442c3c2c537c05d7eb5f0a6e8.jpg" />
<img alt="../../_images/fc730a03788614b2eac2785fe5ebb0b2bbc0036c85822afcf78de346ff1dcb08.jpg" src="../../_images/fc730a03788614b2eac2785fe5ebb0b2bbc0036c85822afcf78de346ff1dcb08.jpg" />
<img alt="../../_images/b308dd090dfcc264779dfb38c3dc2101bced9b232e0a29ed0fbf26f5e63e4b2b.jpg" src="../../_images/b308dd090dfcc264779dfb38c3dc2101bced9b232e0a29ed0fbf26f5e63e4b2b.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average delivery time fluctuates daily (5-20 days)</p></li>
<li><p>Grew from August 2017-February 2018, then dropped sharply to ~8 days</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/92bc40a7ddf71fe4861b064b3b6a6371ef38e54ccecbce5e4d7e76427cebe7cd.jpg" src="../../_images/92bc40a7ddf71fe4861b064b3b6a6371ef38e54ccecbce5e4d7e76427cebe7cd.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Lower ratings typically correlate with longer delivery times</p></li>
</ul>
<p><strong>By Top Customer States</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_state&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ca21d80d947bf7bc780fd380695cd1c8599fe782bce97508cd6bdbc781cc30c9.jpg" src="../../_images/ca21d80d947bf7bc780fd380695cd1c8599fe782bce97508cd6bdbc781cc30c9.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>São Paulo consistently has fastest delivery among top states</p></li>
<li><p>Rio de Janeiro and Rio Grande do Sul show slowest deliveries</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">,</span> <span class="n">to_slide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/11c2b1b9b49898c734a4dad580f38757855d0407034b2e779cf5a4e1074e0ecd.jpg" src="../../_images/11c2b1b9b49898c734a4dad580f38757855d0407034b2e779cf5a4e1074e0ecd.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Rio de Janeiro had steeper delivery time increases (Oct 2017-Feb 2018)</p></li>
</ul>
</section>
<section id="delivery-delay-time">
<h2>Delivery Delay Time<a class="headerlink" href="#delivery-delay-time" title="Link to this heading">#</a></h2>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">delivery_delay_days</span> <span class="o">=</span> <span class="s1">&#39;Average Delivery Delay Time, days&#39;</span>
<span class="p">))</span>
<span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">)]:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">df_sales</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
            <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
            <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
            <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Average Delivery Delay Time by </span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span><span class="p">:</span>
        <span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5b5bf254b4a165d1809a2608195680a1be5116cc07baa0bd9b47eb88a0baf810.jpg" src="../../_images/5b5bf254b4a165d1809a2608195680a1be5116cc07baa0bd9b47eb88a0baf810.jpg" />
<img alt="../../_images/1c59a7487d69ec3a29eb1d51b887975ccd0c2a729712d2bc702bc2978c37c805.jpg" src="../../_images/1c59a7487d69ec3a29eb1d51b887975ccd0c2a729712d2bc702bc2978c37c805.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>All months show faster-than-expected deliveries</p></li>
<li><p>Early 2017 to March 2017: improving lead times (~12 days ahead)</p></li>
<li><p>June 2018: deliveries ~20 days ahead of estimates</p></li>
</ul>
</section>
<section id="carrier-handoff-delay">
<h2>Carrier Handoff Delay<a class="headerlink" href="#carrier-handoff-delay" title="Link to this heading">#</a></h2>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">order_purchase_dt</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">avg_carrier_delivery_delay_days</span> <span class="o">=</span> <span class="s1">&#39;Average Carrier Handoff Delay, days&#39;</span>
<span class="p">))</span>
<span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ME&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">)]:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">df_sales</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
            <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span>
            <span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span>
            <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Average Carrier Handoff Delay by </span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;ME&#39;</span><span class="p">:</span>
        <span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7724834b829eeade5bdf28ca35f98d6cd8c2c9df4b3c9d3bc49b0d579e9fa63f.jpg" src="../../_images/7724834b829eeade5bdf28ca35f98d6cd8c2c9df4b3c9d3bc49b0d579e9fa63f.jpg" />
<img alt="../../_images/fc98bfd0a4cde8c6b2c758b701e34565cd3bd11daba1337a8200bd85d3e5c64d.jpg" src="../../_images/fc98bfd0a4cde8c6b2c758b701e34565cd3bd11daba1337a8200bd85d3e5c64d.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Carrier handoff consistently faster than limits</p></li>
<li><p>Pre-May 2017: improving lead times (peaked at 4.5 days ahead)</p></li>
<li><p>Post-May 2017: declining to ~2.5 days ahead by August</p></li>
</ul>
</section>
<section id="proportion-of-each-stage-in-delivery-time">
<h2>Proportion of Each Stage in Delivery Time<a class="headerlink" href="#proportion-of-each-stage-in-delivery-time" title="Link to this heading">#</a></h2>
<p>Let’s look at what percentage of the total delivery time each stage occupies.</p>
<p>We will not consider any anomalous dates, as there are only a few and they will not significantly affect the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_sales</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_sales</span><span class="p">[[</span>
        <span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;order_approved_dt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;order_delivered_carrier_dt&#39;</span><span class="p">,</span>
        <span class="s1">&#39;order_delivered_customer_dt&#39;</span><span class="p">,</span>
    <span class="p">]]</span>
    <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">order_delivered_customer_dt</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="o">.</span><span class="n">order_purchase_dt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">order_approved_dt</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="o">.</span><span class="n">order_purchase_dt</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">order_delivered_carrier_dt</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="o">.</span><span class="n">order_approved_dt</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">order_delivered_customer_dt</span> <span class="o">&gt;=</span> <span class="n">x</span><span class="o">.</span><span class="n">order_delivered_carrier_dt</span><span class="p">)</span>
     <span class="p">]</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;from_purchase_to_customer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_delivered_customer_dt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
<span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;From Purchase to Approved&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_approved_dt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;from_purchase_to_customer&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;From Approved to Carrier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_delivered_carrier_dt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_approved_dt&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;from_purchase_to_customer&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;From Carrier to Customer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_delivered_customer_dt&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;order_delivered_carrier_dt&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">tmp_df_sales</span><span class="p">[</span><span class="s1">&#39;from_purchase_to_customer&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_df_sales</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">tmp_df_sales</span><span class="p">[[</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="s1">&#39;From Purchase to Approved&#39;</span><span class="p">,</span> <span class="s1">&#39;From Approved to Carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;From Carrier to Customer&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Stage&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Percent of All Delivery Time&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;order_purchase_dt&#39;</span><span class="p">:</span> <span class="s1">&#39;Date&#39;</span><span class="p">})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">category_orders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Stage&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;From Purchase to Approved&#39;</span><span class="p">,</span> <span class="s1">&#39;From Approved to Carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;From Carrier to Customer&#39;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tmp_df_sales</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">area</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Percent of All Delivery Time&#39;</span>
    <span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Stage&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;ME&#39;</span>
    <span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Average Percent of All Delivery Time by Stage and Month&#39;</span>
    <span class="p">,</span> <span class="n">category_orders</span><span class="o">=</span><span class="n">category_orders</span>
<span class="p">)</span>
<span class="n">pb</span><span class="o">.</span><span class="n">to_slide</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e7b8b10ed0ca360543f43057ed089e67f9d03b1ff47c887f1a55669503475b6b.jpg" src="../../_images/e7b8b10ed0ca360543f43057ed089e67f9d03b1ff47c887f1a55669503475b6b.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Carrier delivery consumes most of total delivery time</p></li>
</ul>
</section>
<section id="order-weight">
<h2>Order Weight<a class="headerlink" href="#order-weight" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;total_weight_kg&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Weight of Orders, kg&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Weight of Orders, kg&#39;</span>   
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">upper_quantile</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/114031fea30ac5ea675ca1bc9d688e618b84280e4d807e74c5da183d8893db96.jpg" src="../../_images/114031fea30ac5ea675ca1bc9d688e618b84280e4d807e74c5da183d8893db96.jpg" />
<img alt="../../_images/98ac7093b62c489694530b99be2066a0d978eafcb4604f97ea0fd37933d75145.jpg" src="../../_images/98ac7093b62c489694530b99be2066a0d978eafcb4604f97ea0fd37933d75145.jpg" />
<img alt="../../_images/87902f6a62b085b6fd254b79e631eece0371d5b694b11c7b487e23d9a1a11897.jpg" src="../../_images/87902f6a62b085b6fd254b79e631eece0371d5b694b11c7b487e23d9a1a11897.jpg" />
<img alt="../../_images/5337eee649cf1bb3d4b6bc0114d9d47f7521e95eabd85f28c7519e83dcae07e7.jpg" src="../../_images/5337eee649cf1bb3d4b6bc0114d9d47f7521e95eabd85f28c7519e83dcae07e7.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average order weight declining monthly (2.8kg → 1.9kg)</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c405a5a8f2d45e818db716dcf86e2cd73d54abd9e90a85215c77d680c630f9f5.jpg" src="../../_images/c405a5a8f2d45e818db716dcf86e2cd73d54abd9e90a85215c77d680c630f9f5.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>1-star orders typically heaviest</p></li>
<li><p>2-star orders show most monthly weight variability</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/474e182a5909742d52bac0e18ee999eae5c8df282b85addc77c26f117710f024.jpg" src="../../_images/474e182a5909742d52bac0e18ee999eae5c8df282b85addc77c26f117710f024.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Delayed orders usually heavier</p></li>
<li><p>Non-delayed weights more stable monthly</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/40b3db5fc24301b0151ac5d0bafd646bf502ac1f3ea0d4a661b356826bce75be.jpg" src="../../_images/40b3db5fc24301b0151ac5d0bafd646bf502ac1f3ea0d4a661b356826bce75be.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders consistently heavier</p></li>
</ul>
<p><strong>By Delivery Time Category</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;delivery_time_days_cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cade97cab2de0dc67f876d2575294c1d013b7d62e3b3c54b8c4510525505fbdc.jpg" src="../../_images/cade97cab2de0dc67f876d2575294c1d013b7d62e3b3c54b8c4510525505fbdc.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Lighter orders typically deliver faster</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b3272e65274add5a0f5aefacc44a6a392ffb4a7cd835877d7edb3159f6eb4e0c.jpg" src="../../_images/b3272e65274add5a0f5aefacc44a6a392ffb4a7cd835877d7edb3159f6eb4e0c.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Curitiba shows most monthly weight variability among top cities</p></li>
</ul>
</section>
<section id="number-of-products-in-order">
<h2>Number of Products in Order<a class="headerlink" href="#number-of-products-in-order" title="Link to this heading">#</a></h2>
<p>Prepare dataframe for analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;products_cnt&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Number of Products in Order&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Number of Products in Order&#39;</span>   
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0feecd742f90e2cb4411482935fc5391cd73a7b972cfe715554ec9b973006fda.jpg" src="../../_images/0feecd742f90e2cb4411482935fc5391cd73a7b972cfe715554ec9b973006fda.jpg" />
<img alt="../../_images/cccf82de481b2ed095dbb29b14f4f4af0897c5a3f33e9c12f92a56177d38bb16.jpg" src="../../_images/cccf82de481b2ed095dbb29b14f4f4af0897c5a3f33e9c12f92a56177d38bb16.jpg" />
<img alt="../../_images/e4a2bd186f00305144ac323173043a4455afabf64ed0f8d105acb4025767d57a.jpg" src="../../_images/e4a2bd186f00305144ac323173043a4455afabf64ed0f8d105acb4025767d57a.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average products per order remains stable (1.12-1.16)</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/560effc7bc62edf196c9f0e555ab3fe86994059c8cd133d59f43fa025a90a1a3.jpg" src="../../_images/560effc7bc62edf196c9f0e555ab3fe86994059c8cd133d59f43fa025a90a1a3.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>1/2-star orders typically have more products</p></li>
<li><p>4/5-star orders usually have fewest products</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ca68ae3342e2c841eba7e986c80fbbf1dfe6fe90de07c900da895827843d161f.jpg" src="../../_images/ca68ae3342e2c841eba7e986c80fbbf1dfe6fe90de07c900da895827843d161f.jpg" />
<img alt="../../_images/2a615afac8e9005a14e640f759210a075f27f5b83e52002210a949a85021e68c.jpg" src="../../_images/2a615afac8e9005a14e640f759210a075f27f5b83e52002210a949a85021e68c.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Delayed orders show more product count variability</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/719047c9aa209bd5834b51949e2e9255cba6a22042df7036572e2e8bb95627ee.jpg" src="../../_images/719047c9aa209bd5834b51949e2e9255cba6a22042df7036572e2e8bb95627ee.jpg" />
<img alt="../../_images/59858ee7e0711ff2c71f4aae56c4812909f6e1f36baaad960172c2978d7ab3c1.jpg" src="../../_images/59858ee7e0711ff2c71f4aae56c4812909f6e1f36baaad960172c2978d7ab3c1.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders usually contain more products</p></li>
</ul>
<p><strong>By Top Customer Cities</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;customer_city&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a676bace410e282e09757b218c87d2f9aba83697514bd46c14b05c4e8e016acd.jpg" src="../../_images/a676bace410e282e09757b218c87d2f9aba83697514bd46c14b05c4e8e016acd.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Curitiba shows most monthly product count variability</p></li>
</ul>
</section>
<section id="number-of-unique-products-in-order">
<h2>Number of Unique Products in Order<a class="headerlink" href="#number-of-unique-products-in-order" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;unique_products_cnt&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Number of Unique Products in Order&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Number of Unique Products in Order&#39;</span>    
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c8231641aee44034a6140c781c357920907e552b6072a3bcec9e4b34374c1e3c.jpg" src="../../_images/c8231641aee44034a6140c781c357920907e552b6072a3bcec9e4b34374c1e3c.jpg" />
<img alt="../../_images/3fb04262b6fb7926e27a23606d1c7931026408b07d6ecfe8be8a5b3e3766072c.jpg" src="../../_images/3fb04262b6fb7926e27a23606d1c7931026408b07d6ecfe8be8a5b3e3766072c.jpg" />
<img alt="../../_images/a2c376b6f1d8fc1028c454a8678036350d573bafba9ee67bdaa32331a2863561.jpg" src="../../_images/a2c376b6f1d8fc1028c454a8678036350d573bafba9ee67bdaa32331a2863561.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average unique products per order remains stable (1.03-1.045)</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b778736f23972728fc9a3c164432a584b809d860fee886f797e22a44637715c2.jpg" src="../../_images/b778736f23972728fc9a3c164432a584b809d860fee886f797e22a44637715c2.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>1/2-star orders have more unique products</p></li>
<li><p>4/5-star orders have fewest unique products</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9f7b705fe78e37e7cb9e8bd0375065c00f046265fe55767dbb64c72259988ddf.jpg" src="../../_images/9f7b705fe78e37e7cb9e8bd0375065c00f046265fe55767dbb64c72259988ddf.jpg" />
<img alt="../../_images/e7ded77320fd0090dcbb3471694a2dddd1305bd7cf8ddbfafdc5dc312d89c254.jpg" src="../../_images/e7ded77320fd0090dcbb3471694a2dddd1305bd7cf8ddbfafdc5dc312d89c254.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Non-delayed orders slightly higher in unique products</p></li>
<li><p>Delayed orders show more variability</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d03b3694130910f1cb774649209d72676ae15ba9b6996e0576119f78246df68d.jpg" src="../../_images/d03b3694130910f1cb774649209d72676ae15ba9b6996e0576119f78246df68d.jpg" />
<img alt="../../_images/6877764cde450ea23250a48187063f779ea901a9d7ee1b045bc029715afa93e8.jpg" src="../../_images/6877764cde450ea23250a48187063f779ea901a9d7ee1b045bc029715afa93e8.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders consistently have more unique products</p></li>
</ul>
</section>
<section id="product-price-in-order">
<h2>Product Price in Order<a class="headerlink" href="#product-price-in-order" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;avg_products_price&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Product Price in Order, R$&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Product Price in Order, R$&#39;</span>  
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="n">upper_quantile</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e86cf0b29faa14a516d2102ba1f7d438592412088350c6870289bcff8d104add.jpg" src="../../_images/e86cf0b29faa14a516d2102ba1f7d438592412088350c6870289bcff8d104add.jpg" />
<img alt="../../_images/7a98eddfc6ff06f4df92cbb44eed8190d061d549fd501a0fa16c63fbf708f9d0.jpg" src="../../_images/7a98eddfc6ff06f4df92cbb44eed8190d061d549fd501a0fa16c63fbf708f9d0.jpg" />
<img alt="../../_images/b327658ebf9c199dddf2aabad07512eeb7cbb7f9ef47f8c44fd29c3804c1f9ff.jpg" src="../../_images/b327658ebf9c199dddf2aabad07512eeb7cbb7f9ef47f8c44fd29c3804c1f9ff.jpg" />
<img alt="../../_images/8241003027a84bf1dce32c1e7a7b0f37d933524a9b13dbabb64efe0777a2808a.jpg" src="../../_images/8241003027a84bf1dce32c1e7a7b0f37d933524a9b13dbabb64efe0777a2808a.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>No Black Friday spike in average product price</p></li>
<li><p>Monthly average product price fluctuates (115-135 R$)</p></li>
<li><p>Clear seasonality:</p>
<ul>
<li><p>Pre-July 2017: decline</p></li>
<li><p>July-Oct 2017: growth</p></li>
<li><p>Oct 2017-Mar 2018: decline</p></li>
<li><p>Mar-Apr 2018: growth</p></li>
<li><p>Post-Apr 2018: decline</p></li>
</ul>
</li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4a27403e7ee7c403b7ff8bb71346cca5919b45ec71879f779098cf604a4b15f5.jpg" src="../../_images/4a27403e7ee7c403b7ff8bb71346cca5919b45ec71879f779098cf604a4b15f5.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>1-star orders typically have highest product prices</p></li>
<li><p>3-star orders usually lowest</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/78f0cd89699c6291faceb7239f9862da2ca81a11038d3b96462ae866bed57530.jpg" src="../../_images/78f0cd89699c6291faceb7239f9862da2ca81a11038d3b96462ae866bed57530.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Delayed orders usually have higher product prices</p></li>
<li><p>June 2017 saw sharp price spike in delayed orders</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bad070b755767d77d5a7f1154aa914ff4efa302516db606b97eaa857675c9790.jpg" src="../../_images/bad070b755767d77d5a7f1154aa914ff4efa302516db606b97eaa857675c9790.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders have significantly higher product prices</p></li>
</ul>
</section>
<section id="number-of-sellers-in-order">
<h2>Number of Sellers in Order<a class="headerlink" href="#number-of-sellers-in-order" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;sellers_cnt&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Number of Sellers in Order&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Number of Sellers in Order&#39;</span>    
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/74cd32fa586ba3eb756a0f0f1e64a448a7bacf7cc2e6a1584185b27d4971892e.jpg" src="../../_images/74cd32fa586ba3eb756a0f0f1e64a448a7bacf7cc2e6a1584185b27d4971892e.jpg" />
<img alt="../../_images/d0237a1b35915ca3f607622af3deea2ebfb2de56fe9f5111fb6573f0aa044e21.jpg" src="../../_images/d0237a1b35915ca3f607622af3deea2ebfb2de56fe9f5111fb6573f0aa044e21.jpg" />
<img alt="../../_images/75906d44bad8d5a2815a8f70bfb6b00ec5cf4cd2241e04ebcfe0cd491f412522.jpg" src="../../_images/75906d44bad8d5a2815a8f70bfb6b00ec5cf4cd2241e04ebcfe0cd491f412522.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average sellers per order grows minimally (1→1.02)</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/edcde6e7a7322abba176f2b84c1e8383c5a1f1809b7f4368b3b12e0d85c2e139.jpg" src="../../_images/edcde6e7a7322abba176f2b84c1e8383c5a1f1809b7f4368b3b12e0d85c2e139.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>1/2-star orders typically involve more sellers</p></li>
<li><p>4/5-star orders involve fewest sellers</p></li>
</ul>
<p><strong>By Whether the Order is Delayed or Not</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;is_delayed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1ff5a189b7459e1fb1c50f319787186834fb65263d28461e6171c6cbb6e6dd67.jpg" src="../../_images/1ff5a189b7459e1fb1c50f319787186834fb65263d28461e6171c6cbb6e6dd67.jpg" />
<img alt="../../_images/018f0765cd468f37732a05415b82c5cb257a420c837fab27ae449240af6ffaa3.jpg" src="../../_images/018f0765cd468f37732a05415b82c5cb257a420c837fab27ae449240af6ffaa3.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Non-delayed orders slightly higher in seller count</p></li>
<li><p>April 2018 saw sharp seller count spike in undelivered orders</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/37dcedb5e1d9ed946a99863523643fb976d76487896c160a08958c2f49fcb2a8.jpg" src="../../_images/37dcedb5e1d9ed946a99863523643fb976d76487896c160a08958c2f49fcb2a8.jpg" />
<img alt="../../_images/3d2d952ed12b33b59002f8961ed9d3c562eb2d0d662a0e3f639a8736f744566c.jpg" src="../../_images/3d2d952ed12b33b59002f8961ed9d3c562eb2d0d662a0e3f639a8736f744566c.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders consistently involve more sellers</p></li>
</ul>
</section>
<section id="number-of-categories-in-order">
<h2>Number of Categories in Order<a class="headerlink" href="#number-of-categories-in-order" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sales</span>
    <span class="p">,</span> <span class="n">time_column</span> <span class="o">=</span> <span class="s1">&#39;order_purchase_dt&#39;</span>
    <span class="p">,</span> <span class="n">time_column_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
    <span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;product_categories_cnt&#39;</span>
    <span class="p">,</span> <span class="n">metric_label</span> <span class="o">=</span> <span class="s1">&#39;Average Number of Categories in Order&#39;</span>
    <span class="p">,</span> <span class="n">metric_label_for_distribution</span> <span class="o">=</span> <span class="s1">&#39;Number of Categories in Order&#39;</span>
    <span class="p">,</span> <span class="n">agg_func</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
    <span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ME&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>By Day and Month</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;ME&#39;</span><span class="p">]:</span>
    <span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/da519e9bd2993a52b0e6b310e226f3ff01bf14a0d52d5aa2a4495e855f60bee3.jpg" src="../../_images/da519e9bd2993a52b0e6b310e226f3ff01bf14a0d52d5aa2a4495e855f60bee3.jpg" />
<img alt="../../_images/5687fc1eb5b7037d51ff9e1a2c5f437e1c63ddc590870532280c15d4a50ae0a4.jpg" src="../../_images/5687fc1eb5b7037d51ff9e1a2c5f437e1c63ddc590870532280c15d4a50ae0a4.jpg" />
<img alt="../../_images/219005e67111f4cb8eda277e6fd7c1d7a4c266696225ec2b1495343afd35ca17.jpg" src="../../_images/219005e67111f4cb8eda277e6fd7c1d7a4c266696225ec2b1495343afd35ca17.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Average categories per order remains stable</p></li>
</ul>
<p><strong>By Review Score</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_avg_reviews_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ec1258212133d20acf74c87013393550231a69fc14a3a30d6282f3a15dc7b7d6.jpg" src="../../_images/ec1258212133d20acf74c87013393550231a69fc14a3a30d6282f3a15dc7b7d6.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>1/2-star orders involve more categories</p></li>
</ul>
<p><strong>By Presence of Installment Payments</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pb</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time_series&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">pb</span><span class="o">.</span><span class="n">line_resample</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;order_has_installment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5146416aeb128e43800c133e9d0dc81678e1638c7c3e487df020a8ddc767e45c.jpg" src="../../_images/5146416aeb128e43800c133e9d0dc81678e1638c7c3e487df020a8ddc767e45c.jpg" />
<img alt="../../_images/b44d55ed8f990828b3f3ab2eacc1efa942148c0e50b3ee63e515221df7f16420.jpg" src="../../_images/b44d55ed8f990828b3f3ab2eacc1efa942148c0e50b3ee63e515221df7f16420.jpg" />
</div>
</div>
<p><strong>Key Observations:</strong></p>
<ul class="simple">
<li><p>Installment orders have slightly more categories</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01_creating_analysis_class.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Creating Analysis Class</p>
      </div>
    </a>
    <a class="right-next"
       href="03_customer_analysis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Customer Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#order-volume-vs-successful-purchases">Order Volume vs. Successful Purchases</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#share-of-canceled-orders">Share of Canceled Orders</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-sales">Number of Sales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sales-amount">Sales Amount</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#average-order-value">Average Order Value</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-purchases-per-customer-per-week">Number of Purchases per Customer per Week</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arppu">ARPPU</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-customers">Number of Customers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#share-of-new-customers">Share of New Customers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-sellers">Number of Sellers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#share-of-new-sellers">Share of New Sellers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ratio-of-number-of-sellers-and-customers">Ratio of Number of Sellers and Customers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-orders-per-customer">Number of Orders per Customer</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-reviews">Number of Reviews</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#review-score">Review Score</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nps">NPS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#freight-cost-ratio">Freight Cost Ratio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delivery-time">Delivery Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delivery-delay-time">Delivery Delay Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carrier-handoff-delay">Carrier Handoff Delay</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#proportion-of-each-stage-in-delivery-time">Proportion of Each Stage in Delivery Time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#order-weight">Order Weight</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-products-in-order">Number of Products in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-unique-products-in-order">Number of Unique Products in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#product-price-in-order">Product Price in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-sellers-in-order">Number of Sellers in Order</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#number-of-categories-in-order">Number of Categories in Order</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Pavel Grigoryev
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Pavel Grigoryev.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>